<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Міні база посилок</title>
<style>
  body { font-family: Arial, sans-serif; max-width: 800px; margin: 20px auto; padding: 0 10px; background: #f9f9f9; color: #222; }
  h1 { text-align: center; }
  form { background: #fff; padding: 15px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); margin-bottom: 20px; }
  label { display: block; margin-top: 10px; font-weight: bold; }
  input, textarea { width: 100%; padding: 8px; margin-top: 4px; border: 1px solid #ccc; border-radius: 4px; }
  button { margin-top: 15px; padding: 10px 20px; background: #007bff; border: none; color: white; font-weight: bold; border-radius: 4px; cursor: pointer; }
  button:hover { background: #0056b3; }
  table { width: 100%; border-collapse: collapse; background: white; }
  th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
  th { background: #eee; }
  button.edit, button.delete { padding: 5px 10px; margin-right: 5px; border: none; border-radius: 4px; cursor: pointer; }
  button.edit { background: #28a745; color: white; }
  button.delete { background: #dc3545; color: white; }
</style>
</head>
<body>

<h1>Міні база посилок</h1>

<form id="parcelForm">
  <input type="hidden" id="editIndex" />
  
  <label>№ посилки *</label>
  <input type="text" id="number" required placeholder="Наприклад: ABC123456789" />
  
  <label>Вага (кг) *</label>
  <input type="number" id="weight" required min="0" step="0.01" />
  
  <label>Кількість місць *</label>
  <input type="number" id="placesCount" required min="1" step="1" />
  
  <label>Об’ємна вага (кг) *</label>
  <input type="number" id="volumeWeight" required min="0" step="0.01" />
  
  <label>Відділення Нової Пошти *</label>
  <input type="text" id="npBranch" required placeholder="Назва або номер відділення" />
  
  <label>Телефон отримувача *</label>
  <input type="tel" id="receiverPhone" required placeholder="+380XXXXXXXXX" pattern="^\+?\d{7,15}$" />
  
  <label>Місто *</label>
  <input type="text" id="city" required placeholder="Місто отримувача" />
  
  <label>Опис</label>
  <textarea id="description" rows="2" placeholder="Додаткові деталі"></textarea>
  
  <label>Ціна (€) *</label>
  <input type="number" id="priceEuro" required min="0" step="0.01" />
  
  <button type="submit">Додати / Оновити посилку</button>
</form>

<table aria-label="Список посилок" id="parcelTable">
  <thead>
    <tr>
      <th>№ посилки</th>
      <th>Вага (кг)</th>
      <th>Кількість місць</th>
      <th>Об’ємна вага (кг)</th>
      <th>Відділення НП</th>
      <th>Телефон</th>
      <th>Місто</th>
      <th>Опис</th>
      <th>Ціна (€)</th>
      <th>Дії</th>
    </tr>
  </thead>
  <tbody id="parcelList"></tbody>
</table>

<script>
  const form = document.getElementById('parcelForm');
  const parcelListEl = document.getElementById('parcelList');

  let parcels = JSON.parse(localStorage.getItem('parcels') || '[]');

  function renderTable() {
    parcelListEl.innerHTML = '';
    if(parcels.length === 0) {
      parcelListEl.innerHTML = '<tr><td colspan="10" style="text-align:center;">Посилок не знайдено</td></tr>';
      return;
    }
    parcels.forEach((p, i) => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${p.number}</td>
        <td>${p.weight.toFixed(2)}</td>
        <td>${p.placesCount}</td>
        <td>${p.volumeWeight.toFixed(2)}</td>
        <td>${p.npBranch}</td>
        <td>${p.receiverPhone}</td>
        <td>${p.city}</td>
        <td>${p.description || ''}</td>
        <td>${p.priceEuro.toFixed(2)}</td>
        <td>
          <button class="edit" data-index="${i}">Редагувати</button>
          <button class="delete" data-index="${i}">Видалити</button>
        </td>
      `;
      parcelListEl.appendChild(tr);
    });
  }

  function save() {
    localStorage.setItem('parcels', JSON.stringify(parcels));
  }

  form.addEventListener('submit', e => {
    e.preventDefault();
    const number = document.getElementById('number').value.trim();
    const weight = parseFloat(document.getElementById('weight').value);
    const placesCount = parseInt(document.getElementById('placesCount').value);
    const volumeWeight = parseFloat(document.getElementById('volumeWeight').value);
    const npBranch = document.getElementById('npBranch').value.trim();
    const receiverPhone = document.getElementById('receiverPhone').value.trim();
    const city = document.getElementById('city').value.trim();
    const description = document.getElementById('description').value.trim();
    const priceEuro = parseFloat(document.getElementById('priceEuro').value);

    const editIndex = document.getElementById('editIndex').value;

    const phoneRegex = /^\+?\d{7,15}$/;
    if (!phoneRegex.test(receiverPhone)) {
      alert('Введіть коректний номер телефону у форматі +380XXXXXXXXX');
      return;
    }

    if(editIndex === '') {
      if(parcels.some(p => p.number === number)) {
        alert('Посилка з таким номером уже існує!');
        return;
      }
      parcels.push({number, weight, placesCount, volumeWeight, npBranch, receiverPhone, city, description, priceEuro});
    } else {
      if(parcels.some((p, idx) => p.number === number && idx !== +editIndex)) {
        alert('Посилка з таким номером уже існує!');
        return;
      }
      parcels[+editIndex] = {number, weight, placesCount, volumeWeight, npBranch, receiverPhone, city, description, priceEuro};
    }
    save();
    renderTable();
    form.reset();
    document.getElementById('editIndex').value = '';
  });

  parcelListEl.addEventListener('click', e => {
    if(e.target.classList.contains('edit')) {
      const idx = e.target.dataset.index;
      const p = parcels[idx];
      document.getElementById('editIndex').value = idx;
      document.getElementById('number').value = p.number;
      document.getElementById('weight').value = p.weight;
      document.getElementById('placesCount').value = p.placesCount;
      document.getElementById('volumeWeight').value = p.volumeWeight;
      document.getElementById('npBranch').value = p.npBranch;
      document.getElementById('receiverPhone').value = p.receiverPhone;
      document.getElementById('city').value = p.city;
      document.getElementById('description').value = p.description;
      document.getElementById('priceEuro').value = p.priceEuro;
      window.scrollTo({top: 0, behavior: 'smooth'});
    }
    if(e.target.classList.contains('delete')) {
      const idx = e.target.dataset.index;
      if(confirm(`Видалити посилку №${parcels[idx].number}?`)) {
        parcels.splice(idx,1);
        save();
        renderTable();
      }
    }
  });

  renderTable();
</script>

</body>
</html>