<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Міні база посилок</title>
<style>
  body { font-family: Arial, sans-serif; max-width: 960px; margin: 20px auto; padding: 0 10px; background: #f9f9f9; color: #222; }
  h1 { text-align: center; }
  form { background: #fff; padding: 15px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); margin-bottom: 20px; }
  form label { display: block; margin-top: 10px; font-weight: bold; }
  form input, form textarea { width: 100%; padding: 8px; margin-top: 4px; border: 1px solid #ccc; border-radius: 4px; }
  form button { margin-top: 15px; padding: 10px 20px; background: #007bff; border: none; color: white; font-weight: bold; border-radius: 4px; cursor: pointer; }
  form button:hover { background: #0056b3; }
  table { width: 100%; border-collapse: collapse; background: white; }
  th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
  th { background: #eee; }
  button.edit, button.delete { padding: 5px 10px; margin-right: 5px; border: none; border-radius: 4px; cursor: pointer; }
  button.edit { background: #28a745; color: white; }
  button.delete { background: #dc3545; color: white; }
</style>
</head>
<body>

<h1>Міні база посилок</h1>

<form id="parcelForm" aria-label="Форма додавання або редагування посилки">
  <input type="hidden" id="editIndex" value="" />
  
  <label for="number">№ посилки *</label>
  <input type="text" id="number" required autocomplete="off" placeholder="Наприклад: ABC123456789" />
  
  <label for="weight">Вага (кг) *</label>
  <input type="number" id="weight" required min="0" step="0.01" placeholder="Вага посилки" />
  
  <label for="placesCount">Кількість місць *</label>
  <input type="number" id="placesCount" required min="1" step="1" placeholder="Кількість місць" />
  
  <label for="volumeWeight">Об’ємна вага (кг) *</label>
  <input type="number" id="volumeWeight" required min="0" step="0.01" placeholder="Об’ємна вага" />
  
  <label for="npBranch">Відділення Нової Пошти *</label>
  <input type="text" id="npBranch" required autocomplete="off" placeholder="Назва або номер відділення" />
  
  <label for="receiverPhone">Телефон отримувача *</label>
  <input type="tel" id="receiverPhone" required autocomplete="off" placeholder="+380XXXXXXXXX" pattern="^\+?\d{7,15}$" title="Введіть коректний номер телефону" />
  
  <label for="city">Місто *</label>
  <input type="text" id="city" required autocomplete="off" placeholder="Місто отримувача" />
  
  <label for="description">Опис</label>
  <textarea id="description" rows="2" placeholder="Додаткові деталі"></textarea>
  
  <label for="priceEuro">Ціна (€) *</label>
  <input type="number" id="priceEuro" required min="0" step="0.01" placeholder="Ціна в євро" />
  
  <button type="submit">Додати / Оновити посилку</button>
</form>

<table aria-label="Список посилок" id="parcelTable" role="grid">
  <thead>
    <tr>
      <th>№ посилки</th>
      <th>Вага (кг)</th>
      <th>Кількість місць</th>
      <th>Об’ємна вага (кг)</th>
      <th>Відділення НП</th>
      <th>Телефон</th>
      <th>Місто</th>
      <th>Опис</th>
      <th>Ціна (€)</th>
      <th>Дії</th>
    </tr>
  </thead>
  <tbody id="parcelList"></tbody>
</table>

<script>
  const parcelForm = document.getElementById('parcelForm');
  const parcelListEl = document.getElementById('parcelList');

  let parcels = JSON.parse(localStorage.getItem('parcels') || '[]');

  function renderTable() {
    parcelListEl.innerHTML = '';
    if (parcels.length === 0) {
      parcelListEl.innerHTML = '<tr><td colspan="10" style="text-align:center;">Посилок не знайдено</td></tr>';
      return;
    }
    parcels.forEach((p, i) => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${p.number}</td>
        <td>${p.weight.toFixed(2)}</td>
        <td>${p.placesCount}</td>
        <td>${p.volumeWeight.toFixed(2)}</td>
        <td>${p.npBranch}</td>
        <td>${p.receiverPhone}</td>
        <td>${p.city}</td>
        <td>${p.description || ''}</td>
        <td>${p.priceEuro.toFixed(2)}</td>
        <td>
          <button class="edit" data-index="${i}">Редагувати</button>
          <button class="delete" data-index="${i}">Видалити</button>
        </td>
      `;
      parcelListEl.appendChild(tr);
    });
  }

  function saveParcels() {
    localStorage.setItem('parcels', JSON.stringify(parcels));
  }

  parcelForm.addEventListener('submit', (e) => {
    e.preventDefault();

    const number = document.getElementById('number').value.trim();
    const weight = parseFloat(document.getElementById('weight').value);
    const placesCount = parseInt(document.getElementById('placesCount').value);
    const volumeWeight = parseFloat(document.getElementById('volumeWeight').value);
    const npBranch = document.getElementById('npBranch').value.trim();
    const receiverPhone = document.getElementById('receiverPhone').value.trim();
    const city = document.getElementById('city').value.trim();
    const description = document.getElementById('description').value.trim();
    const priceEuro = parseFloat(document.getElementById('priceEuro').value);

    const editIndex = document.getElementById('editIndex').value;

    // Валідація телефону
    const phoneRegex = /^\+?\d{7,15}$/;
    if (!phoneRegex.test(receiverPhone)) {
      alert('Введіть коректний номер телефону у форматі +380XXXXXXXXX');
      return;
    }

    // Перевірка унікальності номера (якщо додаємо нову)
    if (editIndex === '') {
      if (parcels.some(p => p.number === number)) {
        alert('Посилка з таким номером уже існує!');
        return;
      }
    } else {
      // Якщо редагуємо, номер може залишатися таким самим
      // Але не можна змінити на номер, що вже існує в іншого
      if (parcels.some((p, idx) => p.number === number && idx !== +editIndex)) {
        alert('Посилка з таким номером уже існує!');
        return;
      }
    }

    const parcelData = { number, weight, placesCount, volumeWeight, npBranch, receiverPhone, city, description, priceEuro };

    if (editIndex === '') {
      parcels.push(parcelData);
    } else {
      parcels[+editIndex] = parcelData;
    }

    saveParcels();
    renderTable();

    parcelForm.reset();
    document.getElementById('editIndex').value = '';
  });

  parcelListEl.addEventListener('click', (e) => {
    if (e.target.classList.contains('edit')) {
      const index = e.target.dataset.index;
      const p = parcels[index];
      document.getElementById('editIndex').value = index;
      document.getElementById('number').value = p.number;
      document.getElementById('weight').value = p.weight;
      document.getElementById('placesCount').value = p.placesCount;
      document.getElementById('volumeWeight').value = p.volumeWeight;
      document.getElementById('npBranch').value = p.npBranch;
      document.getElementById('receiverPhone').value = p.receiverPhone;
      document.getElementById('city').value = p.city;
      document.getElementById('description').value = p.description;
      document.getElementById('priceEuro').value = p.priceEuro;
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }
    if (e.target.classList.contains('delete')) {
      const index = e.target.dataset.index;
      if (confirm(`Видалити посилку №${parcels[index].number}?`)) {
        parcels.splice(index, 1);
        saveParcels();
        renderTable();
      }
    }
  });

  // Початковий рендер
  renderTable();
</script>

</body>
</html>