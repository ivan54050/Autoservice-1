<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>База посилок (JSON textarea + PDF)</title>
<style>
  body { font-family: Arial, sans-serif; max-width: 480px; margin: 20px auto; padding: 0 10px; }
  h1 { text-align: center; margin-bottom: 15px; }
  form { background: #f9f9f9; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
  label { display: block; margin-top: 10px; font-weight: bold; }
  input, textarea, button { width: 100%; padding: 8px; margin-top: 5px; box-sizing: border-box; border-radius: 4px; border: 1px solid #ccc; font-size: 1rem; }
  button { background: #007bff; color: white; border: none; cursor: pointer; margin-top: 15px; border-radius: 7px; font-size: 1.1rem; }
  button:hover { background: #0056b3; }
  table { width: 100%; border-collapse: collapse; margin-top: 10px; }
  th, td { padding: 8px 5px; border: 1px solid #ccc; text-align: left; font-size: 0.9rem; }
  th { background: #eee; }
  #jsonData { height: 120px; font-family: monospace; white-space: pre-wrap; }
  .pdf-btn { width: auto; padding: 4px 8px; font-size: 0.85rem; background: #28a745; margin-top: 0; }
  .pdf-btn:hover { background: #1e7e34; }
</style>
</head>
<body>

<h1>База посилок (JSON textarea)</h1>

<form id="parcelForm" autocomplete="off">
  <label for="number">№ посилки *</label>
  <input id="number" type="text" required placeholder="Наприклад: ABC123456789" />

  <label for="weight">Вага (кг) *</label>
  <input id="weight" type="number" step="0.01" min="0" required />

  <label for="placesCount">Кількість місць *</label>
  <input id="placesCount" type="number" min="1" step="1" required />

  <label for="volumeWeight">Обʼємна вага (кг) *</label>
  <input id="volumeWeight" type="number" step="0.01" min="0" required />

  <label for="city">Місто *</label>
  <input id="city" type="text" required />

  <label for="npBranch">Відділення Нової Пошти *</label>
  <input id="npBranch" type="text" required />

  <label for="phone">Номер телефону *</label>
  <input id="phone" type="tel" required placeholder="+380XXXXXXXXX" pattern="^\+?\d{7,15}$" />

  <label for="price">Вартість (€) *</label>
  <input id="price" type="number" step="0.01" min="0" required />

  <label for="description">Опис</label>
  <textarea id="description" rows="2" placeholder="Додаткові деталі"></textarea>

  <button type="submit">Додати посилку</button>
</form>

<h3>Список посилок</h3>
<table>
  <thead>
    <tr>
      <th>№ посилки</th>
      <th>Вага</th>
      <th>Місць</th>
      <th>Обʼємна вага</th>
      <th>Місто</th>
      <th>Відділення НП</th>
      <th>Телефон</th>
      <th>Вартість (€)</th>
      <th>Опис</th>
      <th>PDF</th>
    </tr>
  </thead>
  <tbody id="parcelList"></tbody>
</table>

<h3>Експорт / Імпорт JSON</h3>
<textarea id="jsonData" placeholder="Тут буде JSON. Скопіюйте для збереження або вставте для завантаження"></textarea>
<button id="loadJsonBtn">Завантажити JSON</button>

<!-- jsPDF CDN -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
  const { jsPDF } = window.jspdf;

  const form = document.getElementById('parcelForm');
  const parcelList = document.getElementById('parcelList');
  const jsonData = document.getElementById('jsonData');
  const loadJsonBtn = document.getElementById('loadJsonBtn');

  let parcels = [];

  function renderParcels() {
    parcelList.innerHTML = '';
    if (parcels.length === 0) {
      parcelList.innerHTML = '<tr><td colspan="10" style="text-align:center;">Посилок немає</td></tr>';
      jsonData.value = '';
      return;
    }
    parcels.forEach((p, index) => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${p.number}</td>
        <td>${p.weight.toFixed(2)}</td>
        <td>${p.placesCount}</td>
        <td>${p.volumeWeight.toFixed(2)}</td>
        <td>${p.city}</td>
        <td>${p.npBranch}</td>
        <td>${p.phone}</td>
        <td>${p.price.toFixed(2)}</td>
        <td>${p.description || ''}</td>
        <td><button class="pdf-btn" data-index="${index}">PDF</button></td>
      `;
      parcelList.appendChild(tr);
    });
    jsonData.value = JSON.stringify(parcels, null, 2);
  }

  form.addEventListener('submit', e => {
    e.preventDefault();
    const number = form.number.value.trim();
    const weight = parseFloat(form.weight.value);
    const placesCount = parseInt(form.placesCount.value);
    const volumeWeight = parseFloat(form.volumeWeight.value);
    const city = form.city.value.trim();
    const npBranch = form.npBranch.value.trim();
    const phone = form.phone.value.trim();
    const price = parseFloat(form.price.value);
    const description = form.description.value.trim();

    if(!number || isNaN(weight) || isNaN(placesCount) || isNaN(volumeWeight) || !city || !npBranch || !phone || isNaN(price)) {
      alert('Будь ласка, заповніть усі обовʼязкові поля правильно.');
      return;
    }
    const phoneRegex = /^\+?\d{7,15}$/;
    if (!phoneRegex.test(phone)) {
      alert('Введіть коректний номер телефону.');
      return;
    }

    if(parcels.some(p => p.number === number)) {
      alert('Посилка з таким номером вже існує!');
      return;
    }

    parcels.push({number, weight, placesCount, volumeWeight, city, npBranch, phone, price, description});
    renderParcels();
    form.reset();
  });

  parcelList.addEventListener('click', (e) => {
    if(e.target.classList.contains('pdf-btn')) {
      const idx = e.target.dataset.index;
      generatePdf(parcels[idx]);
    }
  });

  loadJsonBtn.addEventListener('click', () => {
    try {
      const imported = JSON.parse(jsonData.value);
      if (!Array.isArray(imported)) throw new Error('JSON має бути масивом.');
      for (const p of imported) {
        if (typeof p.number !== 'string' || typeof p.city !== 'string') {
          alert('Некоректний формат даних у JSON.');
          return;
        }
      }
      parcels = imported;
      renderParcels();
    } catch(err) {
      alert('Помилка при завантаженні JSON: ' + err.message);
    }
  });

  function generatePdf(parcel) {
    const doc = new jsPDF();
    doc.setFontSize(16);
    doc.text(`Посилка №${parcel.number}`, 10, 20);

    const lines = [
      ['Вага (кг)', parcel.weight.toFixed(2)],
      ['Кількість місць', parcel.placesCount.toString()],
      ['Обʼємна вага (кг)', parcel.volumeWeight.toFixed(2)],
      ['Місто', parcel.city],
      ['Відділення НП', parcel.npBranch],
      ['Телефон', parcel.phone],
      ['Вартість (€)', parcel.price.toFixed(2)],
      ['Опис', parcel.description || ''],
    ];

    let y = 30;
    doc.setFontSize(12);
    lines.forEach(([label, value]) => {
      doc.text(`${label}: ${value}`, 10, y);
      y += 10;
    });

    doc.save(`Posylka_${parcel.number}.pdf`);
  }

  renderParcels();
</script>

</body>
</html>