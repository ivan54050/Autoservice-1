<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Автосервіс - Онлайн</title>
<style>
  /* Загальний стиль */
  body {
    margin: 0; 
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #121212;
    color: #f0f0f0;
  }
  header {
    background: #000;
    padding: 1rem 2rem;
    font-size: 1.5rem;
    font-weight: 700;
    letter-spacing: 2px;
    user-select: none;
    text-align: center;
  }
  nav {
    display: flex;
    justify-content: center;
    background: #222;
  }
  nav button {
    background: none;
    border: none;
    color: #f0f0f0;
    padding: 1rem 2rem;
    cursor: pointer;
    font-weight: 600;
    font-size: 1rem;
    border-bottom: 3px solid transparent;
    transition: border-color 0.3s;
  }
  nav button.active,
  nav button:hover {
    border-bottom: 3px solid #fff;
  }
  main {
    max-width: 900px;
    margin: 2rem auto;
    padding: 0 1rem;
  }
  section {
    display: none;
  }
  section.active {
    display: block;
  }
  /* Форма та таблиці */
  form {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
    margin-bottom: 1.5rem;
  }
  form label {
    display: block;
    font-weight: 600;
    margin-bottom: 0.25rem;
  }
  form input, form textarea {
    width: 100%;
    padding: 0.5rem;
    background: #222;
    border: 1px solid #555;
    border-radius: 4px;
    color: #f0f0f0;
    resize: vertical;
  }
  form textarea {
    grid-column: 1 / -1;
    min-height: 80px;
  }
  form button {
    grid-column: 1 / -1;
    padding: 0.75rem;
    background: #000;
    border: 1px solid #fff;
    color: #fff;
    font-weight: 700;
    cursor: pointer;
    border-radius: 4px;
    transition: background 0.3s;
  }
  form button:hover {
    background: #333;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 1rem;
  }
  th, td {
    border: 1px solid #444;
    padding: 0.75rem;
    text-align: left;
  }
  th {
    background: #222;
  }
  /* Кнопки дій для рядків */
  .action-btn {
    background: none;
    border: none;
    color: #ff4444;
    cursor: pointer;
    font-weight: 700;
  }
  .action-btn:hover {
    color: #ff0000;
  }
  /* PDF і Імпорт/Експорт */
  .controls {
    margin-bottom: 1rem;
    display: flex;
    gap: 1rem;
  }
  .controls button, .controls input[type=file] {
    background: #000;
    border: 1px solid #fff;
    color: #fff;
    font-weight: 700;
    padding: 0.5rem 1rem;
    cursor: pointer;
    border-radius: 4px;
    transition: background 0.3s;
  }
  .controls button:hover {
    background: #333;
  }
  .controls input[type=file] {
    padding: 0.3rem;
  }
</style>
</head>
<body>

<header>Автосервіс Онлайн</header>

<nav>
  <button class="tab-btn active" data-tab="clients">Клієнти</button>
  <button class="tab-btn" data-tab="invoices">Рахунки</button>
  <button class="tab-btn" data-tab="acts">Акти</button>
</nav>

<main>
  <!-- Клієнти -->
  <section id="clients" class="active">
    <h2>Клієнти</h2>
    <form id="clientForm">
      <label for="clientName">Ім'я клієнта</label>
      <input type="text" id="clientName" required placeholder="Петро Іванов" />
      
      <label for="clientPhone">Телефон</label>
      <input type="tel" id="clientPhone" placeholder="+380..." />

      <button type="submit">Додати клієнта</button>
    </form>

    <table id="clientsTable">
      <thead>
        <tr><th>Ім'я</th><th>Телефон</th><th>Дія</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>

  <!-- Рахунки -->
  <section id="invoices">
    <h2>Рахунки</h2>
    <form id="invoiceForm">
      <label for="invoiceClient">Клієнт</label>
      <input type="text" id="invoiceClient" placeholder="Петро Іванов" required />

      <label for="invoiceCar">Авто</label>
      <input type="text" id="invoiceCar" placeholder="Toyota Corolla" required />

      <label for="invoiceWork">Роботи</label>
      <textarea id="invoiceWork" placeholder="Опис робіт" required></textarea>

      <label for="invoicePrice">Ціна, грн</label>
      <input type="number" id="invoicePrice" placeholder="1000" min="0" required />

      <button type="submit">Додати рахунок</button>
    </form>

    <div class="controls">
      <button id="exportInvoices">Експорт JSON</button>
      <button id="importInvoicesBtn">Імпорт JSON</button>
      <input type="file" id="importInvoices" accept=".json" style="display:none" />
      <button id="printInvoices">Друк</button>
      <button id="pdfInvoices">Зберегти PDF</button>
    </div>

    <table id="invoicesTable">
      <thead>
        <tr><th>Клієнт</th><th>Авто</th><th>Роботи</th><th>Ціна, грн</th><th>Дія</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>

  <!-- Акти -->
  <section id="acts">
    <h2>Акти виконаних робіт</h2>
    <form id="actForm">
      <label for="actClient">Клієнт</label>
      <input type="text" id="actClient" placeholder="Петро Іванов" required />

      <label for="actCar">Авто</label>
      <input type="text" id="actCar" placeholder="Toyota Corolla" required />

      <label for="actWork">Роботи</label>
      <textarea id="actWork" placeholder="Опис робіт" required></textarea>

      <button type="submit">Додати акт</button>
    </form>

    <div class="controls">
      <button id="exportActs">Експорт JSON</button>
      <button id="importActsBtn">Імпорт JSON</button>
      <input type="file" id="importActs" accept=".json" style="display:none" />
      <button id="printActs">Друк</button>
      <button id="pdfActs">Зберегти PDF</button>
    </div>

    <table id="actsTable">
      <thead>
        <tr><th>Клієнт</th><th>Авто</th><th>Роботи</th><th>Дія</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>
</main>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
(() => {
  // Вкладки
  const tabs = document.querySelectorAll('nav button.tab-btn');
  const sections = document.querySelectorAll('main section');
  tabs.forEach(tab => {
    tab.addEventListener('click', () => {
      tabs.forEach(t => t.classList.remove('active'));
      tab.classList.add('active');
      sections.forEach(s => s.classList.remove('active'));
      document.getElementById(tab.dataset.tab).classList.add('active');
    });
  });

  // Дані з LocalStorage або пусті
  let clients = JSON.parse(localStorage.getItem('clients')) || [];
  let invoices = JSON.parse(localStorage.getItem('invoices')) || [];
  let acts = JSON.parse(localStorage.getItem('acts')) || [];

  // Функції рендеру таблиць
  function renderClients() {
    const tbody = document.querySelector('#clientsTable tbody');
    tbody.innerHTML = '';
    clients.forEach((c, i) => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${c.name}</td>
        <td>${c.phone || ''}</td>
        <td><button class="action-btn" onclick="deleteClient(${i})">Видалити</button></td>
      `;
      tbody.appendChild(tr);
    });
  }
  function renderInvoices() {
    const tbody = document.querySelector('#invoicesTable tbody');
    tbody.innerHTML = '';
    invoices.forEach((inv, i) => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${inv.client}</td>
        <td>${inv.car}</td>
        <td>${inv.work}</td>
        <td>${inv.price}</td>
        <td><button class="action-btn" onclick="deleteInvoice(${i})">Видалити</button></td>
      `;
      tbody.appendChild(tr);
    });
  }
  function renderActs() {
    const tbody = document.querySelector('#actsTable tbody');
    tbody.innerHTML = '';
    acts.forEach((act, i) => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${act.client}</td>
        <td>${act.car}</td>
        <td>${act.work}</td>
        <td><button class="action-btn" onclick="deleteAct(${i})">Видалити</button></td>
      `;
      tbody.appendChild(tr);
    });
  }

  // Виклики рендеру
  renderClients();
  renderInvoices();
  renderActs();

  // Додавання клієнта
  document.getElementById('clientForm').addEventListener('submit', e => {
    e.preventDefault();
    const name = document.getElementById('clientName').value.trim();
    const phone = document.getElementById('clientPhone').value.trim();
    if (!name) {
      alert('Вкажіть ім\'я клієнта');
      return;
    }
    clients.push({ name, phone });
    localStorage.setItem('clients', JSON.stringify(clients));
    renderClients();
    e.target.reset();
  });

  // Видалення клієнта
  window.deleteClient = i => {
    if (confirm('Видалити клієнта?')) {
      clients.splice(i,1);
      localStorage.setItem('clients', JSON.stringify(clients));
      renderClients();
    }
  };

  // Додавання рахунку
  document.getElementById('invoiceForm').addEventListener('submit', e => {
    e.preventDefault();
    const client = document.getElementById('invoiceClient').value.trim();
    const car = document.getElementById('invoiceCar').value.trim();
    const work = document.getElementById('invoiceWork').value.trim();
    const price = document.getElementById('invoicePrice').value.trim();
    if (!client || !car || !work || !price) {
      alert('Заповніть всі поля рахунку');
      return;
    }
    invoices.push({ client, car, work, price });
    localStorage.setItem('invoices', JSON.stringify(invoices));
    renderInvoices();
    e.target.reset();
  });

  // Видалення рахунку
  window.deleteInvoice = i => {
    if (confirm('Видалити рахунок?')) {
      invoices.splice(i,1);
      localStorage.setItem('invoices', JSON.stringify(invoices));
      renderInvoices();
    }
  };

  // Додавання акту
  document.getElementById('actForm').addEventListener('submit', e => {
    e.preventDefault();
    const client = document.getElementById('actClient').value.trim();
    const car = document.getElementById('actCar').value.trim();
    const work = document.getElementById('actWork').value.trim();
    if (!client || !car || !work) {
      alert('Заповніть всі поля акту');
      return;
    }
    acts.push({ client, car, work });
    localStorage.setItem('acts', JSON.stringify(acts));
    renderActs();
    e.target.reset();
  });

  // Видалення акту
  window.deleteAct = i => {
    if (confirm('Видалити акт?')) {
      acts.splice(i,1);
      localStorage.setItem('acts', JSON.stringify(acts));
      renderActs();
    }
  };

  // Експорт JSON
  function exportJSON(data, filename) {
    const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url; a.download = filename;
    a.click();
    URL.revokeObjectURL(url);
  }

  // Імпорт JSON
  function importJSON(input, callback) {
    if (input.files.length === 0) return;
    const file = input.files[0];
    const reader = new FileReader();
    reader.onload = e => {
      try {
        const data = JSON.parse(e.target.result);
        callback(data);
      } catch {
        alert('Помилка: Невірний формат JSON');
      }
      input.value = '';
    };
    reader.readAsText(file);
  }

  // Експорт/імпорт рахунків
  document.getElementById('exportInvoices').addEventListener('click', () => {
    exportJSON(invoices, 'invoices.json');
  });
  document.getElementById('importInvoicesBtn').addEventListener('click', () => {
    document.getElementById('importInvoices').click();
  });
  document.getElementById('importInvoices').addEventListener('change', () => {
    importJSON(document.getElementById('importInvoices'), data => {
      if (Array.isArray(data)) {
        invoices = invoices.concat(data);
        localStorage.setItem('invoices', JSON.stringify(invoices));
        renderInvoices();
      }
    });
  });

  // Експорт/імпорт актів
  document.getElementById('exportActs').addEventListener('click', () => {
    exportJSON(acts, 'acts.json');
  });
  document.getElementById('importActsBtn').addEventListener('click', () => {
    document.getElementById('importActs').click();
  });
  document.getElementById('importActs').addEventListener('change', () => {
    importJSON(document.getElementById('importActs'), data => {
      if (Array.isArray(data)) {
        acts = acts.concat(data);
        localStorage.setItem('acts', JSON.stringify(acts));
        renderActs();
      }
    });
  });

  // Друк таблиці
  function printTable(tableId, title) {
    const table = document.getElementById(tableId);
    const newWin = window.open('', '_blank');
    newWin.document.write(`
      <html><head><title>${title}</title>
      <style>body{font-family:sans-serif;padding:20px;} table {border-collapse: collapse;width: 100%;} th, td {border: 1px solid #333;padding: 8px;text-align: left;} th {background: #eee;}</style>
      </head><body>
      <h1>${title}</h1>
      ${table.outerHTML}
      </body></html>`);
    newWin.document.close();
    newWin.focus();
    newWin.print();
    newWin.close();
  }

  // Друк рахунків і актів
  document.getElementById('printInvoices').addEventListener('click', () => {
    printTable('invoicesTable', 'Рахунки');
  });
  document.getElementById('printActs').addEventListener('click', () => {
    printTable('actsTable', 'Акти виконаних робіт');
  });

  // Збереження PDF (використовуємо jsPDF)
  const { jsPDF } = window.jspdf;

  function savePDF(tableId, title) {
    const doc = new jsPDF();
    doc.setFontSize(18);
    doc.text(title, 10, 15);

    // Для простоти - конвертуємо таблицю у текст
    const rows = [];
    const table = document.getElementById(tableId);
    const headers = [];
    table.querySelectorAll('thead th').forEach(th => headers.push(th.textContent));
    rows.push(headers);

    table.querySelectorAll('tbody tr').forEach(tr => {
      const row = [];
      tr.querySelectorAll('td').forEach(td => row.push(td.textContent));
      rows.push(row);
    });

    doc.autoTable({
      head: [headers],
      body: rows.slice(1),
      startY: 25,
      styles: { fontSize: 10 },
    });

    doc.save(`${title}.pdf`);
  }

  // Оскільки jsPDF AutoTable не підключений, замінимо savePDF на просте
