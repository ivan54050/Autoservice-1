<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>Список посилок</title>
  <style>
    body { font-family: sans-serif; padding: 10px; max-width: 480px; margin: auto; }
    h1 { text-align: center; margin-bottom: 20px; }
    .parcel { border: 1px solid #ccc; border-radius: 6px; padding: 10px; margin-bottom: 12px; background: #f8f8f8; }
    .parcel strong { display: block; margin-top: 4px; }
    button { width: 100%; margin-top: 10px; padding: 10px; border: none; background: #007bff; color: white; font-size: 16px; border-radius: 5px; }
    button:hover { background: #0056b3; }
  </style>
</head>
<body>

<h1>Список посилок</h1>
<div id="list">Завантаження...</div>
<button onclick="location.href='index.html'">Додати нову посилку</button>

<script>
  const listEl = document.getElementById('list');

  let db;
  const request = indexedDB.open('ParcelsDB', 1);

  request.onsuccess = e => {
    db = e.target.result;
    const tx = db.transaction('parcels', 'readonly');
    const store = tx.objectStore('parcels');
    const getAll = store.getAll();

    getAll.onsuccess = () => {
      const parcels = getAll.result;
      if (parcels.length === 0) {
        listEl.textContent = 'Посилок поки немає.';
        return;
      }

      listEl.innerHTML = '';
      parcels.forEach(p => {
        const div = document.createElement('div');
        div.className = 'parcel';
        div.innerHTML = `
          <strong>№: ${p.number}</strong>
          <div>Вага: ${p.weight.toFixed(2)} кг</div>
          <div>Кількість місць: ${p.count}</div>
          <div>Обʼємна вага: ${p.volumes.map(v => v.toFixed(2)).join(', ')} кг</div>
          <div>Місто: ${p.city}</div>
          <div>Відділення: ${p.branch}</div>
          <div>Телефон: ${p.phone}</div>
          <div>Ціна: €${p.price.toFixed(2)}</div>
          <div>Опис: ${p.desc || '-'}</div>
          <div>Дата: ${new Date(p.createdAt).toLocaleString()}</div>
        `;
        listEl.appendChild(div);
      });
    };

    getAll.onerror = () => {
      listEl.textContent = 'Помилка при завантаженні даних.';
    };
  };

  request.onerror = () => {
    listEl.textContent = 'Не вдалося підключитися до бази.';
  };
</script>

</body>
</html>